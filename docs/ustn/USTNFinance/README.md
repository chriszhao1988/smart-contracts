## USTNFinance

## Functions

### initialize(address \_rolesContract, address \_parameterInfoContract, address \_oracleContract, address \_ustn, address \_ustna)

Initializes the USTNFinance contract with the given parameters.

- `_rolesContract`: The address of the roles contract
- `_parameterInfoContract`: The address of the parameter info contract
- `_oracleContract`: The address of the Oracle contract
- `_ustn`: The address of the USTN contract
- `_ustna`: The address of the USTNAuction contract

### deposit(uint256 tokens) -> bool

Allows a user to deposit USTN tokens into the USTNFinance contract.

- `tokens`: The number of USTN tokens to deposit

- `bool`: Boolean indicating the success of the deposit

### withdrawal(uint256 tokens) -> bool

Allows a user to withdraw USTN tokens from the USTNFinance contract.

- `tokens`: The number of USTN tokens to withdraw

- `bool`: Boolean indicating the success of the withdrawal

### distributeDepositInterest() -> bool

Distributes the interest generated by the daily loans to the depositors.

- `bool`: Boolean indicating the success of the interest distribution

### queryDepositBalance() -> uint256

Query the user's deposit balance.

- `uint256`: The user's deposit balance

### loansRate(uint256 tokens) -> uint256

Calculates the loan exchange rate based on the OSM contract's interest rate.

- `tokens`: The amount of UNIT tokens

- `uint256`: The loan amount in USTN

### loans() -> bool

Allows a user to loan USTN using UNIT tokens.

- `bool`: Boolean indicating the success of the loan

### addLoans(uint number) -> bool

Allows a user to add to their loan to alleviate the risk of liquidation.

- `number`: The index of the loan in the user's loan list

- `bool`: Boolean indicating the success of the operation

### loansBack(uint number, uint tokens) -> bool

Allows a user to repay their loan in USTN and retrieve the equivalent amount of UNIT tokens.

- `number`: The index of the loan in the user's loan list
- `tokens`: The amount of USTN tokens to repay

- `bool`: Boolean indicating the success of the loan repayment

### loanPossible() -> uint

Query the amount of USTN that the bank can loan.

- `uint`: The amount of USTN that the bank can loan

### liquidation() -> bool

Liquidates loans that are below the warning line based on the OSM contract's liquidation rate.

- `bool`: Boolean indicating the success of the liquidation

### auctionOver(address bider, uint tokens, uint a, uint b) -> bool

Triggered when the auction ends and the user gets the auction item.

- `bider`: The address of the auction winner
- `tokens`: The amount of tokens won in the auction
- `a`: The interest amount
- `b`: The mortgage amount

- `bool`: Boolean indicating the success of the auction completion

### queryLoan() -> loanList\[\]

Query all the loan information of a user.

- `loanList[]`: An array containing all the loan details of the user

### GetInitializeData() -> bytes

Returns the initialization data.

- `bytes`: The initialization data

## Structs

### loanList

- `uint timestamp`: The timestamp when the loan was initiated
- `uint initialDebt`: The initial debt amount of the loan
- `uint mortgage`: The amount of UNIT tokens provided as mortgage
- `uint debt`: The total debt to be repaid, including the loan amount and interest
- `uint interest`: The interest amount of the loan
- `uint liquidationState`: The state of the loan (0: normal, 1: warning, 2: liquidated or fully repaid)

## Events

### loanRecord(address \_user, uint n, uint \_unitAmount, uint \_totalDebt, uint \_pledgeRate, uint \_status, uint \_operationStatus, uint \_ustn, uint \_unit, uint \_unitValue, uint \_pledgeRateBefore);

Emitted when there is a change in the loan record.

- `_user`: The address of the user involved in the loan
- `n`: The index of the loan in the user's loan list
- `_unitAmount`: The amount of UNIT tokens provided as mortgage
- `_totalDebt`: The total debt to be repaid, including the loan amount and interest
- `_pledgeRate`: The pledge rate of the loan
- `_status`: The status of the loan (1: normal, 2: warning, 3: clearing)
- `_operationStatus`: The operation status (1: loan, 2: increase position, 3: repay loan, 4: interest calculation, 5: liquidation)
- `_ustn`: The amount of USTN involved in the loan
- `_unit`: The amount of UNIT tokens
- `_unitValue`: The value of the UNIT token
- `_pledgeRateBefore`: The pledge rate before the operation

### dwDetail(uint \_time, uint \_type, address \_user, uint amount);

Emitted when there is a change in the deposit or withdrawal details.

- `_time`: The timestamp of the event
- `_type`: The type of the event (1: deposit, 2: withdrawal, 3: interest)
- `_user`: The address of the user involved in the event
- `amount`: The amount of tokens involved in the event